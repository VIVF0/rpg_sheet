{% extends "template.html" %}
{% block script %}
    <script src="https://cdn.socket.io/4.2.0/socket.io.min.js"></script>
{% endblock %}
{% block conteudo %}
<h1>Chat</h1>
    
<div id="messages"></div>

<input id="message" type="text" placeholder="Message">
<button id="sendButton">Send Message</button>

<script type="text/javascript">
    document.addEventListener('DOMContentLoaded', () => {
        var socket = io();
        var messagesContainer = document.getElementById('messages');
        var messageInput = document.getElementById('message');
        var sendButton = document.getElementById('sendButton');

        var room = {{room}};
        var id_personagem = {{id_personagem}};
        const nome_personagem = '{{nome_personagem}}';

        socket.emit('join', { id_personagem: id_personagem, room: room , nome_personagem: nome_personagem});
        
        sendButton.addEventListener('click', () => {
            var message = messageInput.value;
            socket.emit('message', { id_personagem: id_personagem, message: message, room: room , nome_personagem: nome_personagem});
        });
        
        
        socket.on('message', (data) => {
            var li = document.createElement('li');
            console.log(data)
            if (data.name){
                li.textContent = data.time + " - " + data.name + ": " + data.message;
            }else{
                li.textContent = data.message;
            }
            messagesContainer.appendChild(li);
        });
    });
</script>
{% endblock %}

